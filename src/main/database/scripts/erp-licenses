CREATE DATABASE erp-oficial


-- Conectar ao banco de dados
\c clientes_db;

-- Criação da tabela CLIENTES_CADASTRADOS
CREATE TABLE IF NOT EXISTS clientes_cadastrados (
    -- Chave única (CNPJ)
    cnpj VARCHAR(18) PRIMARY KEY,
    
    -- Razão Social
    razao_social VARCHAR(255) NOT NULL,
    
    -- Nome Fantasia
    nome_fantasia VARCHAR(255),
    
    -- Inscrição Estadual
    inscricao_estadual VARCHAR(50),
    
    -- Telefone
    telefone VARCHAR(20),
    
    -- E-mail
    e_mail VARCHAR(255),
    
    -- Status (Pago ou Não)
    status VARCHAR(20) CHECK (status IN ('PAGO', 'NAO_PAGO')),
    
    -- Localidade (Rua, Número, Bairro, Cidade, Estado, CEP)
    rua VARCHAR(255),
    numero VARCHAR(10),
    bairro VARCHAR(100),
    cidade VARCHAR(100),
    estado VARCHAR(2),
    cep VARCHAR(10),
    
    -- Campos de auditoria
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    data_atualizacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Índices para melhorar performance
CREATE INDEX idx_razao_social ON clientes_cadastrados(razao_social);
CREATE INDEX idx_nome_fantasia ON clientes_cadastrados(nome_fantasia);
CREATE INDEX idx_status ON clientes_cadastrados(status);
CREATE INDEX idx_cidade ON clientes_cadastrados(cidade);
CREATE INDEX idx_estado ON clientes_cadastrados(estado);

-- Trigger para atualizar automaticamente data_atualizacao
CREATE OR REPLACE FUNCTION atualizar_data_modificacao()
RETURNS TRIGGER AS $$
BEGIN
    NEW.data_atualizacao = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_atualizar_data
    BEFORE UPDATE ON clientes_cadastrados
    FOR EACH ROW
    EXECUTE FUNCTION atualizar_data_modificacao();

-- Comentários nas colunas para documentação
COMMENT ON TABLE clientes_cadastrados IS 'Tabela de cadastro de clientes';
COMMENT ON COLUMN clientes_cadastrados.cnpj IS 'CNPJ do cliente (chave primária)';
COMMENT ON COLUMN clientes_cadastrados.razao_social IS 'Razão social da empresa';
COMMENT ON COLUMN clientes_cadastrados.nome_fantasia IS 'Nome fantasia da empresa';
COMMENT ON COLUMN clientes_cadastrados.inscricao_estadual IS 'Inscrição estadual';
COMMENT ON COLUMN clientes_cadastrados.status IS 'Status de pagamento: PAGO ou NAO_PAGO';

-- Exemplo de inserção de dados
INSERT INTO clientes_cadastrados (
    cnpj, razao_social, nome_fantasia, inscricao_estadual,
    telefone, e_mail, status, rua, numero, bairro,
    cidade, estado, cep
) VALUES (
    '12.345.678/0001-90',
    'Empresa Exemplo LTDA',
    'Exemplo Corp',
    '123456789',
    '(11) 98765-4321',
    'contato@exemplo.com.br',
    'PAGO',
    'Rua das Flores',
    '123',
    'Centro',
    'São Paulo',
    'SP',
    '01234-567'
);

-- Consultas úteis

-- Listar todos os clientes
-- SELECT * FROM clientes_cadastrados;

-- Buscar clientes por status
-- SELECT * FROM clientes_cadastrados WHERE status = 'PAGO';

-- Buscar clientes por cidade
-- SELECT * FROM clientes_cadastrados WHERE cidade = 'São Paulo';

-- Contar clientes por status
-- SELECT status, COUNT(*) as total FROM clientes_cadastrados GROUP BY status;